workflows:
  ios-build-for-sibapp:
    name: Build unsigned iOS IPA for SibApp
    environment:
      xcode: latest
    scripts:
      - name: Debug Info
        script: |
          echo "üìÅ Listing root contents:"
          ls -lah
          echo "üîç Checking for UnityFramework target sources:"
          find . -name UnityFramework

      - name: Build Xcode project without signing
        script: |
          echo "üöß Starting archive (no code signing)..."
          xcodebuild \
            -project Unity-iPhone.xcodeproj \
            -scheme Unity-iPhone \
            -configuration Release \
            -archivePath build/Unity.xcarchive \
            archive CODE_SIGNING_ALLOWED=NO

          echo "üì¶ Exporting .ipa..."
          xcodebuild \
            -exportArchive \
            -archivePath build/Unity.xcarchive \
            -exportPath build/export \
            -exportOptionsPlist exportOptions.plist
    artifacts:
      - build/export/*.ipa
